# 小程序广告配置参考

## 一、智能接入模式

### 使用步骤
1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入：流量主 → 广告管理 → 广告位管理
3. 选择【智能接入】模式并点击【创建智能广告】
4. 系统会自动扫描你的小程序页面

### 可能出现"无法插入广告"的原因

#### 1. 小程序状态问题
- ❌ 小程序还未发布
- ❌ 小程序还在审核中
- ❌ 流量主资格未开通或未生效
- ✅ 确保小程序已正式发布且流量主已开通

#### 2. 页面结构问题
- ❌ 页面内容过于简单，缺少足够的内容区块
- ❌ 页面使用了大量条件渲染，系统无法准确分析
- ❌ 页面主要内容在自定义组件中，系统难以识别
- ✅ 页面有清晰的内容区块和层次结构

#### 3. 页面类型限制
- ❌ 纯图片展示页面
- ❌ 纯视频播放页面
- ❌ 纯地图展示页面
- ✅ 包含文本内容、列表、卡片等多种内容类型的页面

## 二、手动接入模式（备选方案）

如果智能接入失败，可以使用手动方式添加广告：

### 1. 获取广告位ID

在微信公众平台：
1. 进入：流量主 → 广告管理 → 广告位管理
2. 点击【新建广告位】
3. 选择广告类型（Banner、插屏、视频等）
4. 获取 `adunit-id`

### 2. 在代码中添加广告组件

#### Banner 广告（横幅广告）
```xml
<!-- 在 wxml 文件中添加 -->
<view class="ad-container">
  <ad unit-id="adunit-xxxxxxxxxxxxxxxx" ad-type="banner" ad-theme="white"></ad>
</view>
```

推荐位置：
- 图片下方
- 页面底部
- 功能区域之间

#### 插屏广告（弹出式广告）
```javascript
// 在 js 文件中添加
Page({
  onLoad() {
    this.initInterstitialAd();
  },

  // 初始化插屏广告
  initInterstitialAd() {
    if (wx.createInterstitialAd) {
      this.interstitialAd = wx.createInterstitialAd({
        adUnitId: 'adunit-xxxxxxxxxxxxxxxx' // 替换为你的广告位ID
      });

      this.interstitialAd.onLoad(() => {
        console.log('插屏广告加载成功');
      });

      this.interstitialAd.onError((err) => {
        console.error('插屏广告加载失败', err);
      });
    }
  },

  // 在适当时机显示广告
  showInterstitialAd() {
    if (this.interstitialAd) {
      this.interstitialAd.show().catch((err) => {
        console.error('插屏广告显示失败', err);
      });
    }
  }
});
```

推荐触发时机：
- 生成图片成功后（每3次显示一次，避免过于频繁）
- 保存图片成功后
- 页面切换时

#### 激励视频广告
```javascript
// 在 js 文件中添加
Page({
  onLoad() {
    this.initRewardedVideoAd();
  },

  initRewardedVideoAd() {
    if (wx.createRewardedVideoAd) {
      this.rewardedVideoAd = wx.createRewardedVideoAd({
        adUnitId: 'adunit-xxxxxxxxxxxxxxxx'
      });

      this.rewardedVideoAd.onClose((res) => {
        if (res && res.isEnded) {
          // 用户看完了视频，可以给予奖励
          console.log('用户看完广告，给予奖励');
        }
      });
    }
  }
});
```

## 三、当前小程序的推荐广告配置

### 首页 (index)

#### 推荐位置1：图片下方
```xml
<!-- 在 image-container 和 input-container 之间 -->
<view class="ad-container">
  <ad unit-id="adunit-xxxxxxxxxxxxxxxx" ad-type="banner" ad-theme="white"></ad>
</view>
```

#### 推荐位置2：功能特色区域下方
```xml
<!-- 在 feature-section 之后 -->
<view class="ad-container">
  <ad unit-id="adunit-xxxxxxxxxxxxxxxx" ad-type="banner" ad-theme="white"></ad>
</view>
```

#### 推荐位置3：插屏广告
在以下时机显示：
- 用户生成图片成功后（每3次显示一次）
- 用户抽卡成功后（每3次显示一次）

### 关于页面 (about)

#### 推荐位置：功能介绍和使用说明之间
```xml
<!-- 在功能介绍和使用说明区域之间 -->
<view class="ad-container">
  <ad unit-id="adunit-xxxxxxxxxxxxxxxx" ad-type="banner" ad-theme="white"></ad>
</view>
```

## 四、广告最佳实践

### 1. 广告展示频率
- Banner广告：可以常驻显示，但不要遮挡主要内容
- 插屏广告：建议每3-5次操作显示一次
- 视频广告：作为激励机制，由用户主动触发

### 2. 广告位置原则
- ✅ 内容区块的自然分隔处
- ✅ 用户操作完成后的过渡位置
- ✅ 页面底部或列表之间
- ❌ 避免遮挡核心功能
- ❌ 避免影响用户体验

### 3. 样式配置
- `ad-theme`: "white" 或 "black"，根据页面背景选择
- 为广告容器添加适当的 margin 和 padding
- 使用半透明背景与页面风格融合

### 4. 错误处理
```javascript
// 广告组件的错误处理
<ad 
  unit-id="adunit-xxxxxxxxxxxxxxxx" 
  ad-type="banner"
  binderror="onAdError"
  bindload="onAdLoad"
></ad>

// JS 中
onAdError(e) {
  console.error('广告加载失败', e);
  // 不要显示错误提示给用户，静默处理即可
},

onAdLoad() {
  console.log('广告加载成功');
}
```

## 五、排查清单

如果遇到"无法插入广告"的问题，请依次检查：

- [ ] 小程序是否已正式发布（非体验版、非开发版）
- [ ] 流量主是否已开通并生效
- [ ] 页面是否有足够的内容区块
- [ ] 页面结构是否清晰（避免过多嵌套和条件渲染）
- [ ] 是否等待了足够的时间（有时需要等待1-2天系统才能识别）
- [ ] 尝试其他页面是否可以插入广告
- [ ] 如果以上都没问题，建议使用手动接入模式

## 六、联系方式

如果仍然无法解决，可以：
1. 在微信公众平台后台提交工单
2. 查看[微信小程序广告文档](https://developers.weixin.qq.com/miniprogram/dev/framework/ad/)
3. 在微信开放社区搜索相关问题

